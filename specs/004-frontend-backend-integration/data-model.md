# Data Model: Frontend-Backend Integration

**Feature**: 004-frontend-backend-integration
**Date**: 2025-12-11
**Phase**: Phase 1 Design

---

## Overview

This document defines all data entities, their properties, relationships, and TypeScript interfaces for the frontend-backend integration feature. All backend entities already exist and are operational (validated in feature 003). Frontend entities are new.

---

## Backend Entities (EXISTING - Reference Only)

### Task Entity

**Source**: Backend `src/models/task.py` (SQLAlchemy model)
**Purpose**: Represents a todo item with completion tracking

**Properties**:
```typescript
interface Task {
  id: string;              // UUID (generated by backend)
  title: string;           // Required, max 255 chars
  description?: string;    // Optional, unlimited length
  is_completed: boolean;   // Default: false
  created_at: string;      // ISO 8601 timestamp (e.g., "2025-12-11T17:05:54.475090")
  updated_at: string;      // ISO 8601 timestamp (auto-updated on changes)
  completed_at?: string;   // ISO 8601 timestamp (null if is_completed is false)
}
```

**Validation Rules**:
- `title`: Required, non-empty string
- `description`: Optional, can be empty string or null
- `is_completed`: Boolean only (true/false)
- `id`: UUID format (validated by backend)
- Timestamps: ISO 8601 format, UTC timezone

**State Transitions**:
```
[Created] → is_completed=false, completed_at=null
   ↓ (PATCH /tasks/{id}/complete)
[Completed] → is_completed=true, completed_at=<timestamp>
   ↓ (PATCH /tasks/{id}/incomplete)
[Incomplete] → is_completed=false, completed_at=null
   ↓ (DELETE /tasks/{id})
[Deleted] → removed from database
```

---

### HistoryEntry Entity

**Source**: Backend `src/models/history.py` (SQLAlchemy model)
**Purpose**: Audit log of all task operations

**Properties**:
```typescript
interface HistoryEntry {
  history_id: string;              // UUID (generated by backend)
  task_id: string;                 // UUID (foreign key to Task)
  action_type: ActionType;         // Enum: CREATED | UPDATED | COMPLETED | INCOMPLETED | DELETED
  description?: string;            // Optional context (e.g., "Title changed from X to Y")
  timestamp: string;               // ISO 8601 timestamp (operation time)
}

type ActionType = 'CREATED' | 'UPDATED' | 'COMPLETED' | 'INCOMPLETED' | 'DELETED';
```

**Action Types**:
- `CREATED`: New task created (POST /tasks)
- `UPDATED`: Task title/description modified (PUT /tasks/{id})
- `COMPLETED`: Task marked complete (PATCH /tasks/{id}/complete)
- `INCOMPLETED`: Task marked incomplete (PATCH /tasks/{id}/incomplete)
- `DELETED`: Task removed (DELETE /tasks/{id})

**Relationships**:
- `task_id` references `Task.id` (many-to-one)
- If task is deleted, history entries remain (audit trail preserved)

**Query Patterns**:
- Chronological order: `ORDER BY timestamp DESC`
- Filter by task: `?task_id={uuid}`
- Filter by action: `?action_type=COMPLETED`
- Pagination: `?page=1&limit=20`

---

### TaskStatistics Entity

**Source**: Backend `src/services/stats_service.py` (computed, not stored)
**Purpose**: Aggregated metrics for analytics dashboard

**Properties**:
```typescript
interface TaskStatistics {
  tasks_created_this_week: number;    // Count of tasks created in current week
  tasks_completed_this_week: number;  // Count of tasks completed in current week
  total_completed: number;            // All-time completed task count
  total_incomplete: number;           // Current incomplete task count
  week_start: string;                 // ISO 8601 date (e.g., "2025-12-08")
  week_end: string;                   // ISO 8601 date (e.g., "2025-12-14")
}
```

**Computation**:
- Week starts on Monday (ISO 8601 standard)
- `week_start`: First day of current week
- `week_end`: Last day of current week
- All counts are computed dynamically (no caching)

**Usage**:
- Endpoint: `GET /api/v1/stats/weekly`
- Refresh frequency: Manual (no real-time updates)
- Use cases: Analytics dashboard charts, metric cards

---

## Frontend Entities (NEW)

### WeeklyChartData

**Purpose**: Data format for Recharts weekly bar chart (completed vs incomplete)

**Properties**:
```typescript
interface WeeklyChartData {
  week: string;              // Week label (e.g., "Week 1", "Dec 8-14", "This Week")
  completed: number;         // Count of completed tasks in this week
  incomplete: number;        // Count of incomplete tasks in this week
}
```

**Transformation from TaskStatistics**:
```typescript
// Example transformation
function transformToWeeklyChartData(stats: TaskStatistics): WeeklyChartData {
  return {
    week: `${stats.week_start} - ${stats.week_end}`,
    completed: stats.tasks_completed_this_week,
    incomplete: stats.tasks_created_this_week - stats.tasks_completed_this_week,
  };
}
```

**Usage**:
- Recharts `<BarChart data={weeklyChartData}>`
- X-axis: `week` label
- Y-axis: Count (completed, incomplete)

---

### ActivityDataPoint

**Purpose**: Time-series data for activity timeline chart (operations over time)

**Properties**:
```typescript
interface ActivityDataPoint {
  date: string;              // ISO 8601 date (e.g., "2025-12-11")
  count: number;             // Number of operations on this date
}
```

**Source**:
- Aggregate HistoryEntry by date: `GROUP BY DATE(timestamp)`
- Sort chronologically: `ORDER BY date ASC`

**Usage**:
- Recharts `<LineChart data={activityData}>`
- X-axis: `date`
- Y-axis: `count`

**Example Dataset**:
```typescript
const activityData: ActivityDataPoint[] = [
  { date: "2025-12-08", count: 5 },
  { date: "2025-12-09", count: 3 },
  { date: "2025-12-10", count: 7 },
  { date: "2025-12-11", count: 4 },
];
```

---

### PaginationInfo

**Purpose**: Pagination metadata for history page

**Properties**:
```typescript
interface PaginationInfo {
  currentPage: number;       // Current page number (1-indexed)
  totalPages: number;        // Total number of pages
  totalItems: number;        // Total count of history entries
  itemsPerPage: number;      // Items per page (default: 20)
}
```

**Computation**:
```typescript
const paginationInfo: PaginationInfo = {
  currentPage: 2,
  totalPages: Math.ceil(totalItems / itemsPerPage),
  totalItems: 150,
  itemsPerPage: 20,
};
```

**Usage**:
- Display: "Page 2 of 8 (150 total entries)"
- Previous button: Disabled if `currentPage === 1`
- Next button: Disabled if `currentPage === totalPages`

---

### HistoryFilters

**Purpose**: Filter parameters for history query

**Properties**:
```typescript
interface HistoryFilters {
  task_id?: string;          // Filter by specific task UUID
  action_type?: ActionType;  // Filter by operation type
}
```

**Usage**:
```typescript
// Example: Fetch history for specific task
fetchHistory(1, { task_id: "abc-123-uuid" });

// Example: Fetch only COMPLETED actions
fetchHistory(1, { action_type: "COMPLETED" });
```

**API Mapping**:
- `task_id` → `/history?task_id={uuid}`
- `action_type` → `/history?action_type=COMPLETED`

---

## Component Prop Interfaces (NEW)

### TaskDetailFormProps

**Purpose**: Props for task detail edit form component

```typescript
interface TaskDetailFormProps {
  task: Task;                                      // Task being edited
  onSave: (updates: Partial<Task>) => Promise<void>; // Save handler (calls PUT /tasks/{id})
  onCancel: () => void;                            // Cancel handler (returns to view mode)
  loading: boolean;                                // Loading state (disable form during save)
  error?: string | null;                           // Error message (display in form)
}
```

**Usage**:
```typescript
<TaskDetailForm
  task={currentTask}
  onSave={handleSave}
  onCancel={handleCancel}
  loading={isSaving}
  error={error}
/>
```

---

### WeeklyChartProps

**Purpose**: Props for Recharts weekly bar chart component

```typescript
interface WeeklyChartProps {
  data: WeeklyChartData[];   // Chart data (completed vs incomplete by week)
  loading: boolean;          // Loading state (show spinner)
}
```

**Usage**:
```typescript
<WeeklyChart
  data={weeklyChartData}
  loading={isLoadingStats}
/>
```

---

### MetricCardProps

**Purpose**: Props for analytics metric display card

```typescript
import { LucideIcon } from 'lucide-react';

interface MetricCardProps {
  title: string;             // Metric label (e.g., "Total Completed")
  value: number;             // Metric value (e.g., 42)
  icon: LucideIcon;          // Lucide icon component (e.g., CheckCircle2)
  colorClass: string;        // TailwindCSS text color (e.g., "text-purple-600")
  bgClass: string;           // TailwindCSS background color (e.g., "bg-purple-100")
}
```

**Usage**:
```typescript
import { CheckCircle2 } from 'lucide-react';

<MetricCard
  title="Total Completed"
  value={stats.total_completed}
  icon={CheckCircle2}
  colorClass="text-purple-600"
  bgClass="bg-purple-100"
/>
```

---

### ActivityTimelineProps

**Purpose**: Props for Recharts activity timeline chart

```typescript
interface ActivityTimelineProps {
  data: ActivityDataPoint[]; // Time-series data (operations by date)
  loading: boolean;          // Loading state
}
```

**Usage**:
```typescript
<ActivityTimeline
  data={activityData}
  loading={isLoadingHistory}
/>
```

---

### HistoryListProps

**Purpose**: Props for history entry list component

```typescript
interface HistoryListProps {
  entries: HistoryEntry[];              // History entries to display
  loading: boolean;                     // Loading state
  pagination: PaginationInfo;           // Pagination metadata
  onPageChange: (page: number) => void; // Page change handler
}
```

**Usage**:
```typescript
<HistoryList
  entries={historyEntries}
  loading={isLoading}
  pagination={paginationInfo}
  onPageChange={handlePageChange}
/>
```

---

### HistoryEntryProps

**Purpose**: Props for single history entry display component

```typescript
interface HistoryEntryProps {
  entry: HistoryEntry;       // History entry to display
}
```

**Usage**:
```typescript
{entries.map((entry) => (
  <HistoryEntry key={entry.history_id} entry={entry} />
))}
```

---

## SweetAlert2 Configuration Interfaces

### AlertConfig

**Purpose**: Base configuration for SweetAlert2 alerts

```typescript
interface AlertConfig {
  title: string;                  // Alert title
  text?: string;                  // Alert body text (optional)
  icon: 'success' | 'error' | 'warning' | 'info' | 'question';
  confirmButtonText?: string;     // Confirm button label (default: "OK")
  cancelButtonText?: string;      // Cancel button label (if applicable)
  confirmButtonColor?: string;    // Confirm button color (default: purple #7c3aed)
  showCancelButton?: boolean;     // Show cancel button (default: false)
}
```

---

### ConfirmDialogConfig

**Purpose**: Configuration for confirmation dialogs (requires cancel button)

```typescript
interface ConfirmDialogConfig extends AlertConfig {
  showCancelButton: true;         // Always true for confirm dialogs
  cancelButtonText: string;       // Required (e.g., "Cancel")
}
```

**Usage**:
```typescript
const config: ConfirmDialogConfig = {
  title: 'Delete Task?',
  text: 'This action cannot be undone.',
  icon: 'warning',
  confirmButtonText: 'Yes, delete',
  cancelButtonText: 'Cancel',
  confirmButtonColor: '#dc2626', // Red for destructive action
  showCancelButton: true,
};
```

---

## Custom Hook Return Types

### UseHistoryReturn

**Purpose**: Return type for `useHistory` custom hook

```typescript
interface UseHistoryReturn {
  entries: HistoryEntry[];                              // Current history entries
  loading: boolean;                                     // Loading state
  error: string | null;                                 // Error message
  pagination: PaginationInfo;                           // Pagination metadata
  fetchHistory: (page?: number, filters?: HistoryFilters) => Promise<void>;
  clearError: () => void;                               // Clear error state
}
```

**Usage**:
```typescript
const { entries, loading, pagination, fetchHistory } = useHistory();

useEffect(() => {
  fetchHistory(1); // Load page 1 on mount
}, []);
```

---

### UseStatsReturn

**Purpose**: Return type for `useStats` custom hook

```typescript
interface UseStatsReturn {
  stats: TaskStatistics | null;       // Statistics data (null if not loaded)
  loading: boolean;                   // Loading state
  error: string | null;               // Error message
  fetchStats: () => Promise<void>;    // Fetch stats from API
  clearError: () => void;             // Clear error state
}
```

**Usage**:
```typescript
const { stats, loading, fetchStats } = useStats();

useEffect(() => {
  fetchStats(); // Load stats on mount
}, []);
```

---

## Entity Relationships Diagram

```
┌─────────────────┐
│      Task       │
│  (Backend DB)   │
│─────────────────│
│ id (PK)         │◄──────┐
│ title           │       │
│ description     │       │ (Foreign Key)
│ is_completed    │       │
│ created_at      │       │
│ updated_at      │       │
│ completed_at    │       │
└─────────────────┘       │
                          │
                          │
                ┌─────────┴────────┐
                │  HistoryEntry    │
                │  (Backend DB)    │
                │──────────────────│
                │ history_id (PK)  │
                │ task_id (FK)     │
                │ action_type      │
                │ description      │
                │ timestamp        │
                └──────────────────┘
                          │
                          │ (Aggregate)
                          ▼
                ┌──────────────────┐
                │ TaskStatistics   │
                │  (Computed)      │
                │──────────────────│
                │ tasks_created    │
                │ tasks_completed  │
                │ total_completed  │
                │ total_incomplete │
                │ week_start       │
                │ week_end         │
                └──────────────────┘
                          │
                          │ (Transform)
                          ▼
            ┌─────────────────────────┐
            │   Frontend Entities     │
            │─────────────────────────│
            │ • WeeklyChartData       │
            │ • ActivityDataPoint     │
            │ • PaginationInfo        │
            │ • Component Props       │
            └─────────────────────────┘
```

---

## Data Flow: API → Frontend

### Example: Analytics Page Data Flow

```typescript
// 1. API Response (GET /stats/weekly)
const apiResponse: TaskStatistics = {
  tasks_created_this_week: 10,
  tasks_completed_this_week: 7,
  total_completed: 42,
  total_incomplete: 15,
  week_start: "2025-12-08",
  week_end: "2025-12-14"
};

// 2. Transform to Chart Data
const chartData: WeeklyChartData[] = [
  {
    week: "Dec 8-14",
    completed: 7,
    incomplete: 3  // 10 created - 7 completed
  }
];

// 3. Render Chart
<WeeklyChart data={chartData} loading={false} />

// 4. Display Metrics
<MetricCard title="Total Completed" value={42} icon={CheckCircle2} />
<MetricCard title="Total Incomplete" value={15} icon={Circle} />
```

---

## Validation Rules Summary

| Entity | Field | Validation |
|--------|-------|-----------|
| Task | title | Required, non-empty string, max 255 chars |
| Task | description | Optional, unlimited length |
| Task | is_completed | Boolean only (true/false) |
| Task | id | UUID format (validated by backend) |
| HistoryEntry | action_type | Must be one of: CREATED, UPDATED, COMPLETED, INCOMPLETED, DELETED |
| HistoryEntry | task_id | Must reference existing Task.id (backend validates) |
| TaskStatistics | week_start | ISO 8601 date, must be Monday |
| TaskStatistics | week_end | ISO 8601 date, must be Sunday |
| WeeklyChartData | completed | Non-negative integer |
| WeeklyChartData | incomplete | Non-negative integer |
| PaginationInfo | currentPage | Integer >= 1 |
| PaginationInfo | totalPages | Integer >= 1 |
| PaginationInfo | itemsPerPage | Integer > 0 (default: 20) |

---

## Next Phase

**Phase 1 Remaining Deliverables**:
1. `contracts/api-endpoints.yaml` - OpenAPI spec for all 9 endpoints
2. `contracts/component-interfaces.ts` - Complete TypeScript interface definitions
3. `quickstart.md` - Developer onboarding guide

---

**Data Model Status**: ✅ COMPLETE
**All Entities Defined**: 3 backend (existing) + 8 frontend (new)
**All Interfaces Documented**: Component props, hook returns, filters, config types

*Data model completed 2025-12-11 using spec-driven development workflow*
